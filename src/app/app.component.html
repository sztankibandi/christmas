<div class="page">
  <header class="hero">
    <p class="eyebrow">üéÑ √únnepi √ºzenet</p>
    <h1>{{ heroTitle }}</h1>
    <p class="subtitle">{{ heroSubtitle }}</p>
  </header>

  <section class="quiz-card" aria-live="polite">
    <div class="progress" role="progressbar" [attr.aria-valuenow]="progressValue" aria-valuemin="0" aria-valuemax="100">
      <div class="progress__value" [style.width.%]="progressValue"></div>
    </div>

    <div class="question-head">
      <p class="step">{{ currentIndex + 1 }} / {{ totalQuestions }}</p>
      <h2>{{ currentQuestion.question }}</h2>
      <p class="attempts">H√°tral√©v≈ë hib√°k: {{ 3 - incorrectAttempts }} / 3</p>
      <p class="hint" *ngIf="currentQuestion.hint">üí° {{ currentQuestion.hint }}</p>
    </div>

    <div class="answer-field">
      <label class="sr-only" for="answer-input">V√°lasz</label>
      <input
        *ngIf="currentQuestion.type === 'date'; else textInput"
        id="answer-input"
        type="date"
        [(ngModel)]="userAnswer"
        [disabled]="giftUnlocked"
        (keydown.enter)="submitAnswer()"
      />
      <ng-template #textInput>
        <div class="choices">
          <button
            type="button"
            class="choice"
            *ngFor="let opt of currentChoices"
            (click)="selectChoice(opt)"
            [disabled]="giftUnlocked"
            [class.selected]="opt === selectedChoice"
          >
              <ng-container *ngIf="isImage(opt); else textOpt">
              <img [src]="'/assets/memes/' + opt" alt="{{ opt }}" />
            </ng-container>
            <ng-template #textOpt>{{ opt }}</ng-template>
          </button>
        </div>
      </ng-template>
    </div>

    <div class="actions">
      <button
        class="primary"
        type="button"
        (click)="submitAnswer()"
        [disabled]="giftUnlocked || (currentQuestion.type !== 'date' ? !selectedChoice : !userAnswer)"
      >
        V√°lasz elk√ºld√©se
      </button>
      <button class="ghost" type="button" (click)="restartQuiz()">√öjrakezd√©s</button>
    </div>

    <p class="feedback feedback--ok" *ngIf="feedback === 'correct' && !giftUnlocked">T√∂k√©letes! Mehet√ºnk tov√°bb.</p>
    <p class="feedback feedback--error" *ngIf="feedback === 'incorrect'">Hmm, ez most nem stimmel. Gondold √°t √∫jra!</p>
    <p class="feedback feedback--info" *ngIf="feedback === 'missing'">El≈ëbb √≠rj be egy v√°laszt, hogy √©rt√©kelhess√ºk.</p>

    <button class="secondary" type="button" *ngIf="showNextButton" (click)="goToNextQuestion()">
      K√∂vetkez≈ë k√©rd√©s ‚ûú
    </button>
  </section>

  <section class="gift-card" *ngIf="giftUnlocked">
    <h3>üéÅ Meg√©rdemelt aj√°nd√©k</h3>
    <p>Mind a {{ totalQuestions }} k√©rd√©s megvan! M√°r csak egy kattint√°s.</p>
    <button class="primary" type="button" (click)="openGift()" [disabled]="giftOpened">
      {{ giftOpened ? 'Az aj√°nd√©k m√°r fel van t√°rva' : 'Aj√°nd√©k felnyit√°sa' }}
    </button>

    <div class="gift-content" *ngIf="giftOpened">
      <p>Fogadd szeretettel a titkos √ºzenetet:</p>
      <p>Kedves Bar√°tom! Nagyon sz√©pen k√∂sz√∂n√∂m a milli√≥ nevet√©st, s√≠r√°st √©s minden egy√ºtt t√∂lt√∂tt percet. ≈êszint√©n boldog vagyok, hogy megtal√°ltam azt a bar√°tomat, aki mellett teljesen √∂nmagam lehetek √©s nem kell m√°st mutatnom. T√©nyleg h√°l√°s vagyok az√©rt, hogy felvett√©l a c√©ghez √©s ilyen j√≥ bar√°tom lett√©l. Tudd, hogy mindig sz√°m√≠thatsz r√°m t√∂rt√©njen b√°rmi. √âs v√©gezet√ºl csak annyit mondan√©k: EZ VAN B√ÅTTYA. üéÖ</p>
        <div style="margin-top:12px; display:flex; gap:10px; align-items:center;">
          <button class="primary" type="button" (click)="sendTestEmail()" [disabled]="isSending">
            <span *ngIf="!isSending">Aj√°nd√©k e-mailben kik√ºld√©s</span>
            <span *ngIf="isSending" class="loading">
              <span class="spinner" aria-hidden></span> K√ºld√©s...
            </span>
          </button>
        </div>
    </div>
  </section>
</div>
